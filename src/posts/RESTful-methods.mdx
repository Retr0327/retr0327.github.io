---
title: 關於 HTTP Request Method 的方法屬性
createdAt: '2023-02-13'
updatedAt: '2023-02-14'
excerpt: 一直以來我都只認為自己知道何時該用什麼樣的 HTTP request methods，但詳細去了解他們的屬性後，才發現自己漏掉很多很重要的基本知識。
slug: '/blog/p/RESTful-methods'
category: ['HTTP', 'RESTful']
coverImage: 'https://www.openprogrammer.info/wp-content/uploads/2015/01/restful.gif'
---

不知道大家是不是跟我一樣，在一開始學 RESTful 架構時，總是認為以下幾個 HTTP request methods 就是對應 CRUD：

- POST → create
- GET → read
- PUT → update
- DELETE → delete

但開發時間久了，我發現自己會過度拘泥於語意，導致自己的程式變得沒有那麼 RESTful。後來我才知道，自己的對 HTTP request
methods 的理解一直有誤，因為我沒有把 method properties (方法屬性) 給納入考量。舉例來說，我在做使用者更新時，總是用
PUT 的方式去更新 database，但如果根據 idempotent 來去思考，會發現 PATCH 更適合而不是
PUT，是因為 PUT 要求我們提供整個資源的內容，而不是部分。

## Method Properties (方法屬性)

Method properties (方法屬性) 是指每個 HTTP verbs 的特性，像是他們的語意、安全與否、是否 idempotent (幂等) 或可不可以
cache。這些屬性之所以重要是因為它們決定了每個 verbs 如何被使用。

| Verb   | Safe | Idempotent | Cacheable | Action       | Semantics                              |
| ------ | ---- | ---------- | --------- | ------------ | -------------------------------------- |
| GET    | O    | O          | O         | 讀取         | 請求所需要的資源                       |
| HEAD   | O    | O          | O         | 讀取         | 與 GET 相同，但沒有 response body      |
| POST   | X    | X          | O         | 新增         | request 帶上 payload，執行特定資源處理 |
| PATCH  | X    | X          | X         | **部分**更新 | request 帶上 payload，更新部分內容     |
| PUT    | X    | O          | X         | **完整**更新 | request 帶上 payload，更全部分內容     |
| DELETE | X    | O          | X         | 刪除         | 刪除資源                               |

### Safe Method (安全方法)

其實講的是在請求的過程中，是否有任何資源被改動。如果沒有，那就是
safe；反之，有改動則為 unsafe：

- safe：GET、HEAD
- unsafe：POST、PUT、DELETE

之所以要規範 safe 和 unsafe 是為了要避免像是網頁爬蟲或是預先載入（pre-fetching）的執行，不小觸發了 unsafe
methods。假設你的 URL 長這樣：

```url
https://example.com?article=2&action=delete
```

那可能在經過 Google 的爬蟲後，整個文章都直接被刪除了。

### Idempotent Method (冪等方法)

除了第一次，不管請求被執行了 n 次，所回傳的結果都是相同的：

- idempotent：GET、HEAD、PUT、DELETE
- non-idempotent：POST、PATCH

> [Triton Ho from 真 . 淺談 RESTful API]雖然原始 HTTP POST 定義是 non-idempotent，但是他沒禁止你自行解決 idempotent 問題

之所以要區分 idempotent 和 non-idempotent 是因為我們不能永遠保證網路的可靠性 ~(一整個
CAP 理論的既視感)~，如果 client 端使用 non-idempotent
的話可能會不小心刪除多個資源或建立多個副本。相較之下，如果使用 idempotent 的方法，client
則可以隨心所欲地重試請求。

在 Triton Ho 大神的 [真 . 淺談 RESTful API](https://github.com/TritonHo/slides/blob/master/Taipei%202015-11%20talk/RESTful%20API%20Design-tw-2.0.pdf)
有提到說是否 idempotent 是看我們怎麼去做改動的，以 PATCH 為例：

- idempotent：SET Age = 31
- non-idempotent：SET Age = Age + 1

### Cacheable Method (可快取方法)

指的是可以被 cache 的 HTTP request methods，也就是 GET、HEAD 和 POST。

#### 參考資料

1. [真 . 淺談 RESTful API](https://github.com/TritonHo/slides/blob/master/Taipei%202015-11%20talk/RESTful%20API%20Design-tw-2.0.pdf)
2. [HTTP Verbs: 談 POST, PUT 和 PATCH 的應用](https://ihower.tw/blog/archives/6483#comments)
3. [HTTP 請求方法 (Request Method)](https://notfalse.net/43/http-request-method#-Method-Properties)
